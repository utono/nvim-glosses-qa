Generate shell scripts to analyze Shakespeare plays line-by-line.

**Arguments: $ARGUMENTS**

Arguments should be one or more paths to play files. Wildcards are supported:
- Single file: `~/utono/literature/shakespeare-william/gutenberg/henry_v_gut.txt`
- Multiple files: `~/utono/literature/shakespeare-william/gutenberg/*.txt`
- Specific plays: `~/utono/.../hamlet_gut.txt ~/utono/.../macbeth_gut.txt`

## Usage

```
/analyze-plays ~/utono/literature/shakespeare-william/gutenberg/henry_v_gut.txt
/analyze-plays ~/utono/literature/shakespeare-william/gutenberg/*.txt
/analyze-plays ~/utono/.../hamlet_gut.txt ~/utono/.../othello_gut.txt
```

## What This Does

1. **Expands wildcards** to find all matching .txt files
2. **Reads each play file** to discover its complete structure
3. **Identifies all acts, scenes, prologues, and epilogues** per play
4. **Generates a shell script** for each play
5. **Reports summary** of all generated scripts

## Steps to Execute

### Step 1: Expand arguments and find files

Expand `~` to full path. Expand wildcards using glob patterns.
Filter to only existing `.txt` files. Report how many plays found.

Example:
```
Found 37 play files matching: ~/utono/literature/shakespeare-william/gutenberg/*.txt
```

### Step 2: For each play file, analyze structure

Search the play file for structural markers using these patterns:
- `^PROLOGUE\.\s*$` - Prologue markers
- `^ACT\s+([IVX]+|FIRST|SECOND|THIRD|FOURTH|FIFTH)\.\s*$` - Act markers
- `^SCENE\s+([IVX]+)\.` - Scene markers
- `^EPILOGUE\.\s*$` - Epilogue marker

Build a structure like:
```
{
  "has_opening_prologue": true/false,  # PROLOGUE before any ACT
  "acts": {
    1: {"has_prologue": false, "scenes": [1, 2]},
    2: {"has_prologue": true, "scenes": [1, 2, 3, 4]},
    ...
  },
  "has_epilogue": true/false
}
```

**Important**: Track whether prologues appear:
- Before any ACT marker = opening prologue (act=0, scene=0)
- After an ACT marker but before SCENE = act prologue (act=N, scene=0)

### Step 3: Extract play name

From filename: `henry_v_gut.txt` â†’ `henry-v`

### Step 4: Generate shell script for each play

Create script at: `~/utono/nvim-glosses-qa/scripts/analyze_{play_name}.sh`

Script template:
```bash
#!/bin/bash
# analyze_{play_name}.sh - Analyze the entirety of {Play Name}
# Generated by /analyze-plays command
#
# Usage: ./analyze_{play_name}.sh [--dry-run]
#
# Structure discovered:
#   - Opening Prologue: {yes/no}
#   - Acts: {list}
#   - Epilogue: {yes/no}
#   - Total output files: {count}

PLAY="{full_path_to_play}"
ANALYZER=~/utono/nvim-glosses-qa/python/scene_analyzer.py
MERGE=15
DRY_RUN=""

# Check for --dry-run flag
if [ "$1" = "--dry-run" ] || [ "$1" = "-n" ]; then
    DRY_RUN="--dry-run"
    echo "=== DRY RUN MODE ==="
fi

echo "Analyzing {Play Name}..."
echo "Play file: $PLAY"
echo "Merge threshold: $MERGE lines"
echo ""

# Opening Prologue (if exists)
{opening_prologue_section}

# Act sections (generated based on structure)
{act_sections}

# Epilogue (if exists)
{epilogue_section}

echo ""
echo "=== Complete ==="
echo "Output directory: ~/utono/literature/glosses/{play_name}/"
```

### Analyzer call format (IMPORTANT)

The `scene_analyzer.py` takes **positional** act/scene arguments, NOT flags:

```bash
# CORRECT: positional arguments
python "$ANALYZER" "$PLAY" 4 7 --merge "$MERGE" $DRY_RUN

# WRONG: flag-style arguments (will fail)
python "$ANALYZER" "$PLAY" --act 4 --scene 7 --merge "$MERGE" $DRY_RUN
```

Generate each section call like this:

```bash
# Opening Prologue (act 0, scene 0)
echo "--- Prologue (Opening) ---"
python "$ANALYZER" "$PLAY" 0 0 --merge "$MERGE" $DRY_RUN

# Regular scene (Act 4, Scene 7)
echo "--- Act 4, Scene 7 ---"
python "$ANALYZER" "$PLAY" 4 7 --merge "$MERGE" $DRY_RUN

# Act prologue (Act 2, scene 0)
echo "--- Act 2, Prologue ---"
python "$ANALYZER" "$PLAY" 2 0 --merge "$MERGE" $DRY_RUN

# Epilogue (act after last, scene 0) - e.g., if play has 5 acts, use 6 0
echo "--- Epilogue ---"
python "$ANALYZER" "$PLAY" 6 0 --merge "$MERGE" $DRY_RUN
```

### Step 5: Make each script executable

Run: `chmod +x ~/utono/nvim-glosses-qa/scripts/analyze_{play_name}.sh`

### Step 6: Report summary to user

Output a summary table showing:
- Each play processed
- Structure (acts, scenes, prologues)
- Total output files per play
- Path to generated script

## Example Output

For `/analyze-plays ~/utono/literature/shakespeare-william/gutenberg/*.txt`:

```
## Plays Analyzed: 3 files processed

| Play | Acts | Scenes | Prologues | Epilogue | Files | Script |
|------|------|--------|-----------|----------|-------|--------|
| Henry V | 5 | 23 | 6 | Yes | 28 | analyze_henry-v.sh |
| Hamlet | 5 | 20 | 0 | No | 20 | analyze_hamlet.sh |
| Macbeth | 5 | 28 | 0 | No | 28 | analyze_macbeth.sh |

**Total output files across all plays:** 76

## Generated Scripts

Scripts saved to: `~/utono/nvim-glosses-qa/scripts/`

### To run all (dry-run first recommended):

```bash
# Preview what will be processed
for script in ~/utono/nvim-glosses-qa/scripts/analyze_*.sh; do
    "$script" --dry-run
done

# Or run individually:
~/utono/nvim-glosses-qa/scripts/analyze_henry-v.sh --dry-run
~/utono/nvim-glosses-qa/scripts/analyze_hamlet.sh --dry-run
```
```

## Roman Numeral Conversion

For parsing:
- I=1, II=2, III=3, IV=4, V=5, VI=6, VII=7, VIII=8, IX=9, X=10
- FIRST=1, SECOND=2, THIRD=3, FOURTH=4, FIFTH=5

## Play File Locations

Shakespeare plays: `~/utono/literature/shakespeare-william/gutenberg/`

## Notes

- Scripts are saved in `~/utono/nvim-glosses-qa/scripts/`
- Merge threshold defaulted to 15 lines (can edit script to change)
- Supports `--dry-run` flag to preview without API calls
- Caching means reruns skip already-analyzed speeches
- Wildcards expand at runtime, so `*.txt` matches all text files in directory
