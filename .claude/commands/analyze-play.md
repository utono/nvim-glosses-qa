Generate a shell script to analyze an entire Shakespeare play line-by-line.

**Arguments: $ARGUMENTS**

The argument should be a full path to a play file, e.g.:
`~/utono/literature/shakespeare-william/gutenberg/henry_v_gut.txt`

## Usage

```
/analyze-play ~/utono/literature/shakespeare-william/gutenberg/henry_v_gut.txt
/analyze-play /home/mlj/utono/literature/shakespeare-william/gutenberg/hamlet_gut.txt
```

## What This Does

1. **Reads the play file** to discover its complete structure
2. **Identifies all acts, scenes, prologues, and epilogues**
3. **Generates a shell script** tailored to that specific play
4. **Saves the script** for the user to run

## Steps to Execute

### Step 1: Validate the play file exists

Expand `~` to full path if needed. Verify the file exists.

### Step 2: Analyze play structure

Search the play file for structural markers using these patterns:
- `^PROLOGUE\.\s*$` - Prologue markers
- `^ACT\s+([IVX]+|FIRST|SECOND|THIRD|FOURTH|FIFTH)\.\s*$` - Act markers
- `^SCENE\s+([IVX]+)\.` - Scene markers
- `^EPILOGUE\.\s*$` - Epilogue marker

Build a structure like:
```
{
  "has_opening_prologue": true/false,  # PROLOGUE before any ACT
  "acts": {
    1: {"has_prologue": false, "scenes": [1, 2]},
    2: {"has_prologue": true, "scenes": [1, 2, 3, 4]},
    ...
  },
  "has_epilogue": true/false
}
```

**Important**: Track whether prologues appear:
- Before any ACT marker = opening prologue (act=0, scene=0)
- After an ACT marker but before SCENE = act prologue (act=N, scene=0)

### Step 3: Extract play name

From filename: `henry_v_gut.txt` â†’ `henry-v`

### Step 4: Generate shell script

Create script at: `~/utono/nvim-glosses-qa/scripts/analyze_{play_name}.sh`

Script template:
```bash
#!/bin/bash
# analyze_{play_name}.sh - Analyze the entirety of {Play Name}
# Generated by /analyze-play command
#
# Usage: ./analyze_{play_name}.sh [--dry-run]
#
# Structure discovered:
#   - Opening Prologue: {yes/no}
#   - Acts: {list}
#   - Epilogue: {yes/no}
#   - Total output files: {count}

PLAY="{full_path_to_play}"
ANALYZER=~/utono/nvim-glosses-qa/python/scene_analyzer.py
MERGE=15
DRY_RUN=""

# Check for --dry-run flag
if [ "$1" = "--dry-run" ] || [ "$1" = "-n" ]; then
    DRY_RUN="--dry-run"
    echo "=== DRY RUN MODE ==="
fi

echo "Analyzing {Play Name}..."
echo "Play file: $PLAY"
echo "Merge threshold: $MERGE lines"
echo ""

# Opening Prologue (if exists)
{opening_prologue_section}

# Act sections (generated based on structure)
{act_sections}

# Epilogue (if exists)
{epilogue_section}

echo ""
echo "=== Complete ==="
echo "Output directory: ~/utono/literature/glosses/{play_name}/"
```

### Analyzer call format (IMPORTANT)

The `scene_analyzer.py` takes **positional** act/scene arguments, NOT flags:

```bash
# CORRECT: positional arguments
python "$ANALYZER" "$PLAY" 4 7 --merge "$MERGE" $DRY_RUN

# WRONG: flag-style arguments (will fail)
python "$ANALYZER" "$PLAY" --act 4 --scene 7 --merge "$MERGE" $DRY_RUN
```

Generate each section call like this:

```bash
# Opening Prologue (act 0, scene 0)
echo "--- Prologue (Opening) ---"
python "$ANALYZER" "$PLAY" 0 0 --merge "$MERGE" $DRY_RUN

# Regular scene (Act 4, Scene 7)
echo "--- Act 4, Scene 7 ---"
python "$ANALYZER" "$PLAY" 4 7 --merge "$MERGE" $DRY_RUN

# Act prologue (Act 2, scene 0)
echo "--- Act 2, Prologue ---"
python "$ANALYZER" "$PLAY" 2 0 --merge "$MERGE" $DRY_RUN

# Epilogue (act after last, scene 0) - e.g., if play has 5 acts, use 6 0
echo "--- Epilogue ---"
python "$ANALYZER" "$PLAY" 6 0 --merge "$MERGE" $DRY_RUN
```

### Step 5: Make script executable

Run: `chmod +x ~/utono/nvim-glosses-qa/scripts/analyze_{play_name}.sh`

### Step 6: Report to user

Output:
- Play structure summary (acts, scenes, prologues, epilogue)
- Total number of output files that will be generated
- Path to the generated script
- Instructions to run it

## Example Output

For Henry V:

```
## Play Structure: Henry V

| Act | Content |
|-----|---------|
| - | Opening Prologue |
| 1 | 2 scenes |
| 2 | Prologue + 4 scenes |
| 3 | Prologue + 7 scenes |
| 4 | Prologue + 8 scenes |
| 5 | Prologue + 2 scenes |
| - | Epilogue |

**Total output files:** 28

## Generated Script

Script saved to: `~/utono/nvim-glosses-qa/scripts/analyze_henry-v.sh`

### To run (dry-run first recommended):

```bash
# Preview what will be processed
~/utono/nvim-glosses-qa/scripts/analyze_henry-v.sh --dry-run

# Run the full analysis
~/utono/nvim-glosses-qa/scripts/analyze_henry-v.sh
```

Output will be saved to: `~/utono/literature/glosses/henry-v/`
```

## Roman Numeral Conversion

For parsing:
- I=1, II=2, III=3, IV=4, V=5, VI=6, VII=7, VIII=8, IX=9, X=10
- FIRST=1, SECOND=2, THIRD=3, FOURTH=4, FIFTH=5

## Play File Locations

Shakespeare plays: `~/utono/literature/shakespeare-william/gutenberg/`

Common files:
- `henry_v_gut.txt` - Henry V
- `hamlet_gut.txt` - Hamlet
- `macbeth_gut.txt` - Macbeth
- `romeo_juliet_gut.txt` - Romeo and Juliet
- `othello_gut.txt` - Othello
- `midsummer_gut.txt` - A Midsummer Night's Dream

## Notes

- Scripts are saved in `~/utono/nvim-glosses-qa/scripts/`
- Merge threshold defaulted to 15 lines (can edit script to change)
- Supports `--dry-run` flag to preview without API calls
- Caching means reruns skip already-analyzed speeches
